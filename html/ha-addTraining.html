<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/lib/select2-3.5.1/select2.css" rel="stylesheet">

    <link href="/css/js.css" rel="stylesheet">


</head>
<body>

<!-- ------------------------------------------- HEADER ZONE ------------------------------------------- -->
<nav class="navbar navbar-inverse" role="navigation">
    <div class=" col-md-10 col-sm-10 col-xs-10 ">
        <form class="navbar-form navbar-left" style="width:100%" role="search">
            <a href="/" class="btn btn-link " style="margin:0px;padding:0px"><span
                    class="glyphicon glyphicon-arrow-left "></span></a>
            <label><h5 style="color:white"> Add a Training Plan</h5></label>
        </form>
    </div>

    <div class=" col-md-2 col-sm-2 col-xs-2 ">
            <form class="navbar-form navbar-left"  style="width:100%" role="search">
                {% if user %}
                    <span style="color: white">{{ user.nickname() }} {{ user.email() }}</span>
                    <button type="submit" class="btn btn-link"><span class="glyphicon glyphicon-stats"></span></button>
                    <a type="button"  href="{{ url }}" type="submit" class="btn btn-warning">Se déconnecter</a>
                {% else %}
                    <a type="button"  href="{{ url }}" type="submit" class="btn btn-default">Se connecter</a>
                {% endif %}
            </form>
        </div>
</nav>
<!-- ------------------------------------------- HEADER ZONE END ------------------------------------------- -->

<form role="form">
    <div class="row" style="margin-bottom:10px">
        <div class=" col-md-1 col-sm-0 col-xs-0 "></div>
        <div class=" col-md-2 col-sm-2 col-xs-12 ">
            <label for="inputTitle">Title</label>
        </div>
        <div class=" col-md-6 col-sm-6 col-xs-12 ">
            <input type="text" class="form-control" id="inputTitle" required
                   placeholder="Enter your Training plan title">
        </div>
        <div class=" col-md-3 col-sm-4 hidden-xs">
            <div class=" col-md-4 col-sm-4 hidden-xs">
                <span class="glyphicon glyphicon-time"></span>
                <p id="totalTimeValue">0</p>
            </div>
        </div>
    </div>
    <div class="row">
        <div class=" col-md-1 col-sm-0 col-xs-0 "></div>
        <div class=" col-md-2 col-sm-2 col-xs-12 ">
            <label for="inputDescription">Description</label>
        </div>
        <div class=" col-md-6 col-sm-6 col-xs-12 ">
            <!--<input type="email" class="form-control" id="inputDescription" placeholder="Enter your Training plan Description">-->
            <textarea id="inputDescription" class="form-control" rows="4" required></textarea>
        </div>
    </div>
    <div class="row" style="margin-top:10px">
        <div class=" col-md-1 col-sm-0 col-xs-0 "></div>
        <div class=" col-md-2 col-sm-2 col-xs-12 ">
            <label for="inputDescription">Domain</label>
        </div>
        <div class=" col-md-6 col-sm-6 col-xs-12 ">
            <p>
                <select id="e1" class="select2-container populate" style="width:100%">
                    <option value="Running">Running</option>
                    <option value="Volleyball">Volleyball</option>
                    <option value="Boxe">Boxe</option>
                    <option value="BaseBall">BaseBall</option>
                </select>
            </p>
        </div>
    </div>
    <div class="row">
        <div class=" col-md-1 col-sm-0 col-xs-0 "></div>
        <div class=" col-md-9 col-sm-12 col-xs-12 ">
            <div class="jumbotron" style="padding:10px">

                <div class="row">
                    <div class=" col-md-1 col-sm-1 col-xs-1 ">
                        <button type="button" id="btn-add-exercice" class="btn btn-success" required>Add an Exercice
                        </button>
                    </div>
                    <div class=" col-md-12 col-sm-12 col-xs-12 "></div>
                </div>
                <div class="row">
                    <div class=" col-md-2 col-sm-0 col-xs-0 "></div>
                    <div class=" col-md-2 col-sm-2 col-xs-12 ">
                        <label for="titleDescription">Ex. Title</label>
                    </div>
                    <div class=" col-md-6 col-sm-6 col-xs-12 ">
                        <input type="text" class="form-control" id="titleDescription"
                               placeholder="Enter your exercice title" required>
                    </div>
                    <div class=" col-md-2 col-sm-4 col-xs-12 ">
                        <label for="repetition">Répétitions</label>
                        <input id="repetition" type="number" type="text" class="form-control" value="0" required>
                        <label for="duree">Durée en minutes</label>
                        <input id="duree" type="number" class="form-control" value="0" required>
                    </div>
                </div>
                <div class="row" style="margin-top:10px">
                    <div class=" col-md-2 col-sm-0 col-xs-0 "></div>
                    <div class=" col-md-2 col-sm-2 col-xs-12 ">
                        <label for="exerciceDescription">Ex. Description</label>
                    </div>
                    <div class=" col-md-6 col-sm-6 col-xs-12 ">
                        <!--<input type="email" class="form-control" id="exerciceDescription" placeholder="Enter your exercice title">-->
                        <textarea id="exerciceDescription" class="form-control" rows="4"></textarea>
                    </div>
                    <div class=" col-md-2 col-sm-4 hidden-xs">
                        <h1 style="text-align: center;"><span class="glyphicon glyphicon-time"></span></h1>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class=" col-md-1 col-sm-0 col-xs-0 "></div>
    <div class=" col-md-9 col-sm-12 col-xs-12 ">
        <table class="table table-striped table-condensed" id="all-exercices">
            <thead>
            <td>Répétitions</td>
            <td>Titre</td>
            <td>Description</td>
            <td>Durée</td>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    <div class=" col-md-2 ol-sm-0 col-xs-0 "></div>
    <div class=" col-md-10 ol-sm-5 col-xs-0 "></div>
    <div class=" col-md-2 ol-sm-5 col-xs-12 text-center">
        <a type="button" href="./" id="cancel-training-plan" class="btn btn-danger btn-sm"><span
                class="glyphicon glyphicon-remove"></span></a>
        <button type="button" id="add-training-plan" class="btn btn-success btn-lg"><span
                class="glyphicon glyphicon-ok"></span></button>
    </div>


</form>


<!-- ------------------------------------------- FOOTER ZONE ------------------------------------------- -->
<!-- <nav class="navbar navbar-inverse navbar-fixed-bottom" role="navigation">
   <div class=" col-md-10 col-sm-10 col-xs-10 ">
       <form class="navbar-form navbar-left"  style="width:100%" role="search">
           <button type="submit" class="btn btn-danger"> <span class="glyphicon glyphicon-plus-sign"></span> </button>
          <label style="color:white">Add a Training Plan</label>
     </form>
   </div>
 </nav>-->
<!-- ------------------------------------------- FOOTER ZONE END ------------------------------------------- -->

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="/js/jquery-1.11.1.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/js/bootstrap.min.js"></script>
<script src="/lib/select2-3.5.1/select2.min.js"></script>
<script>
    $(document).ready(function () {
        $("#e1").select2();
    });

    //add an exercice
    $("#btn-add-exercice").click(function () {
        var titleDescription = $('#titleDescription').val();
        var exerciceDescription = $('#exerciceDescription').val();
        var duree = $('#duree').val();
        var repetition = $('#repetition').val();

        var ID = Math.random().toString(36).substr(2, 9);

        var tr = "<tr id='" + ID + "'>" +
                "<td>" + repetition + "</td>" +
                "<td>" + titleDescription + "</td>" +
                "<td class='hidden-xs'><p>" + exerciceDescription + '</p></td>' +
                "<td class='time-exercice'>" + duree + "</td>" +
                "<td>" +
                "<button type='button' onclick='deleteExercice(\"" + ID + "\")' class='btn btn-danger btn-sm'><span class='glyphicon glyphicon-remove'></span></button>" +
                "</td>" +
                "</tr>";

        $('#all-exercices > tbody:last-child').append(tr);
        var time = $('.time-exercice');
        totalTimeValue = 0;
        for (i = 0; i < time.size(); i++) {
            totalTimeValue += parseInt(time[i].textContent);
        }
        $('#totalTimeValue').html(totalTimeValue);
    });

    //delete exercice
    function deleteExercice(id) {
        $("#" + id).remove();
        var time = $('.time-exercice');
        totalTimeValue = 0;
        for (i = 0; i < time.size(); i++) {
            totalTimeValue += parseInt(time[i].textContent);
        }
        $('#totalTimeValue').html(totalTimeValue);
    }

    //add training plan
    $("#add-training-plan").click(function () {
        var inputTitle = $('#inputTitle').val();
        var inputDescription = $('#inputDescription').val();
        var domain = $('#e1').val();
        var duree_plan = parseInt($('#totalTimeValue').text());
        var tab_exercices = $('#all-exercices tr');

        if (inputTitle != '' && inputDescription != '' && domain != '') {
            if (tab_exercices.size() > 1) {


                var exercices = [];
                for (i = 1; i < tab_exercices.size(); i++) {
                    var tmp = [];
                    for (j = 0; j < $(tab_exercices[i]).find('td').size(); j++) {
                        var element = $(tab_exercices[i]).find('td')[j];
                        tmp.push($(element).text());
                    }
                    exercice = {
                        'titleDescription': tmp[1],
                        'exerciceDescription': tmp[2],
                        'duree': tmp[3],
                        'repetition': tmp[0]
                    };
                    exercices.push(exercice);
                    exercice = {};
                }

                var data = {
                    'inputTitle': inputTitle,
                    'inputDescription': inputDescription,
                    'domain': domain,
                    'duree_plan': duree_plan,
                    'exercices': JSON.stringify(exercices)
                };
                $.ajax({
                    url: '/Admin/add_training',
                    type: 'GET',
                    dataType: 'json',
                    data: data
                });
                alert("C'est Ok !");
            }
            else {
                alert('Veuillez ajouter au moins un exercice !');
            }
        }
        else {
            alert('Veuillez remplir les champs !');
        }
    });

</script>

</body>
</html>